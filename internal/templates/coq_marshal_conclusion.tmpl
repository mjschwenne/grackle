
  wp_load. iApply "HÎ¦". iModIntro. rewrite -?app_assoc.
  iFrame. iPureIntro.

  << $refs := (refFields .Fields) ->>
  << $msgs := (messageFields .Fields) ->>
  << if gt (len $msgs) 0 ->>
  unfold has_encoding. exists << range $idx, $field := $msgs ->>
  <<- if $idx >>, << end ->>
  <<- .Name ->>_enc
  <<- end ->>. << range $idx, $field := $msgs >>
  split.
  { << if not $idx ->>
    << range $refs ->>
    << if isCoqType . "list u8" ->>
    rewrite Hargs_<< .Name >>_sz. rewrite w64_to_nat_id.
    << else if isCoqType . "string" ->>
    rewrite string_bytes_length.
    << end ->>
    <<- end ->>
    <<- end ->>
    exact. }
  <<- end >> { exact. }
  <<- else >> done.
  <<- end >>
Qed.
