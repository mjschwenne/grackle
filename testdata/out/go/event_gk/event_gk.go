//--------------------------------------
// This file is autogenerated by grackle
// DO NOT MANUALLY EDIT THIS FILE
//--------------------------------------

package event_gk

import (
	"github.com/goose-lang/primitive"
	"github.com/goose-lang/std"
	"github.com/tchajed/marshal"

	"github.com/mjschwenne/grackle/testdata/out/go/timestamp_gk"
	"github.com/mjschwenne/grackle/testdata/out/go/user_gk"
)

type S struct {
	Id        uint32
	Name      string
	StartTime timestamp_gk.S
	EndTime   timestamp_gk.S
	Attendees []user_gk.S
}

func Marshal(enc []byte, e S) []byte {
	enc = marshal.WriteInt32(enc, e.Id)
	primitive.AssumeNoStringOverflow(e.Name)
	enc = marshal.WriteLenPrefixedBytes(enc, []byte(e.Name))
	enc = timestamp_gk.Marshal(enc, e.StartTime)
	enc = timestamp_gk.Marshal(enc, e.EndTime)

	enc = marshal.WriteInt(enc, uint64(len(e.Attendees)))
	enc = marshal.WriteSlice[user_gk.S](enc, e.Attendees, user_gk.Marshal)

	return enc
}

func Unmarshal(s []byte) (S, []byte) {

	id, s := marshal.ReadInt32(s)
	nameBytes, s := marshal.ReadLenPrefixedBytes(s)
	name := string(std.BytesClone(nameBytes))
	startTime, s := timestamp_gk.Unmarshal(s)
	endTime, s := timestamp_gk.Unmarshal(s)
	attendeesLen, s := marshal.ReadInt(s)
	attendees, s := marshal.ReadSlice[user_gk.S](s, attendeesLen, user_gk.Unmarshal)

	return S{
		Id:        id,
		Name:      name,
		StartTime: startTime,
		EndTime:   endTime,
		Attendees: attendees,
	}, s
}
